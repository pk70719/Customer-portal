<script>
  const BASE_URL = "https://suriyawan-backend-68z3.onrender.com";
  const STATIC_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InByYWRlZXBzZXRoNjQ2IiwiaWF0IjoxNzQ5ODk5NzI4LCJleHAiOjE3NDk5MDY5Mjh9.xFpbbAnE1MphCMDQQXprpsURy-x4UK7DrR_lFjlTVYE";

  localStorage.setItem("ownerToken", STATIC_TOKEN);
  const token = STATIC_TOKEN;

  function create() {
    const pname = document.getElementById("pname").value.trim();
    const price = document.getElementById("price").value.trim();
    const cname = document.getElementById("cname").value.trim();
    const addr = document.getElementById("addr").value.trim();
    const mobile = document.getElementById("mobile").value.trim();

    if (!pname || !price || !cname || !addr || !mobile) {
      return alert("âš ï¸ Please fill all fields.");
    }

    const data = { productName: pname, price, customerName: cname, address: addr, mobile };

    fetch(`${BASE_URL}/api/tracking/create`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(res => {
      if (res.success) {
        alert("âœ… Tracking Created: " + res.trackingId);
        load();
      } else {
        alert("âŒ Failed: " + (res.message || "Unknown error"));
      }
    })
    .catch(err => {
      alert("âŒ Server error.");
      console.error(err);
    });
  }

  function load() {
    const search = document.getElementById("search").value.trim();

    fetch(`${BASE_URL}/api/tracking/all?search=${search}`, {
      headers: { "Authorization": "Bearer " + token }
    })
    .then(res => res.json())
    .then(res => {
      if (res.success) {
        const html = res.data.map(x => `
          <div class="card">
            <b>ğŸ†” Tracking ID:</b> ${x.trackingId}<br>
            <b>ğŸ“¦ Product:</b> ${x.productName} â€“ â‚¹${x.price}<br>
            <b>ğŸ‘¤ Customer:</b> ${x.customerName} (${x.mobile})<br>
            <b>ğŸ  Address:</b> ${x.address}<br>
            <img src="https://barcode.tec-it.com/barcode.ashx?data=${x.trackingId}&code=Code128" />
          </div>
        `).join("");
        document.getElementById("output").innerHTML = html;
      } else {
        document.getElementById("output").innerHTML = "<p>âŒ No data found</p>";
      }
    })
    .catch(err => {
      document.getElementById("output").innerHTML = "<p>âŒ Network error</p>";
      console.error(err);
    });
  }

  load();
</script>
